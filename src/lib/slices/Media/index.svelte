<script lang="ts">
	import { PrismicText, PrismicImage } from '@prismicio/svelte';
	import type { Content } from '@prismicio/client';

	export let slice: Content.MediaSlice;

	const style = slice.primary.style || 'full';
    
    const styleClasses = {
        logo: 'w-full',
        full: 'w-full',
        big: 'w-full px-3 md:px-8',
        inline: 'box'
    }[style];

	const maskPath = `M1517.9,25.1c-7.4,11.5-13.1,23.6-15.7,36.5-4.4,21-6.3,42.5-5.5,64.1.5,14.3.3,28.7.2,43,0,3.3,1.9,8.1-1.9,9.4-1.6.6-3.2-5.1-4.4-8.1-14.5-37.9-28.8-75.8-43.4-113.7-4.7-12.2-8.4-24.7-17.1-35.3-10.2-12.4-23.1-17.9-38.4-18.7-12.6-.6-25.3-.5-38,0-11.6.4-21.5,5.8-30.5,12.5-3.4,2.5-4.8,3.1-8.1,0C1305.3,5.8,1293.6,0,1279.9,0,1202.7-.2,1125.5-.3,1048.4,0c-26.4.1-40.6,13.1-50.7,34.1-6.8,14.1-12.3,29-12.4,45.3,0,4.3-1.2,8.5-1.9,12.8-.2,1.1-.2,2.6-1.5,3-1.8.6-2.6-1.1-3.2-2.2-3.5-6-6.7-12.1-10.2-18.1-10.2-17.2-17.7-36-30.1-52-9.8-12.7-23.3-18.7-38.3-18.8-61.6-.6-123.3,0-184.9-.4-12.2,0-21.8,6.1-32.3,10.4-.8.4-1.5,1.2-2.1,1.9-12.2,13-20.6,28.5-24.2,45.7-3.6,17-5.6,34.4-5.8,51.9,0,2.2,1.1,5.7-1.5,6.3-2.5.6-3.1-3-4.1-5-11.1-20.3-21.9-40.8-33.2-61-6-10.8-11.5-21.9-19.4-31.7-10-12.3-23.2-17.7-38-18.1-32.3-.8-64.5-.2-96.8-.3-11.6,0-20.8,6.4-30.6,10.9-1.6.7-2.5,2.8-3.8,4.2-9.7,10.8-15.8,23.8-22.7,36.4-9.1,16.8-18,33.7-27.1,50.5-.7,1.3-1,3.7-3.3,3-1.5-.5-1.1-2.4-1.3-3.8-.9-8.3-1.7-16.6-2.9-24.9-1-7.3-1.4-14.9-3.7-21.9-4.4-13.6-9.6-26.7-18.8-38.3C333,6.8,319.2.4,302.9.2,258-.2,213,.2,168.1,0,162.5,0,157.2.9,152.3,3.5c-6.1,3.2-13.2,4.4-18.1,9.8-12.2,13.7-20.4,29.6-23.7,47.5-3.3,18-6,36.2-5.4,54.8.6,19.8,0,39.7.4,59.5.5,23.1-1.1,46.2,2.7,69.4,2.6,16.1,4.6,32.2,12.3,46.8,5.6,10.7,11.6,21.5,22.9,27.7,2.4,1.3,2.8,3.7,2.8,6.2.2,30.1.5,60.2.6,90.3,0,5.7-.9,6.2-6.3,4.1-5.8-2.1-11.3-5-17.8-4.9-21,.2-42-.2-63.1.2-10.5.2-20.4,4.4-28.3,10.9-7.3,5.9-12.3,14.4-16.6,23.1C3,472.1.5,497.5.2,522.6c-.6,57.8.5,115.7.8,173.5,0,8.9.7,17.7,1.3,26.5,1.7,22.4,6.7,43.8,17.7,63.5,17.9,31.9,35.4,63.9,53.7,95.5,6.3,10.9,13.9,20.7,27.2,25.1,7.5,2.5,14.7,4.9,22.8,4.8,30.4-.3,60.7-.2,91,0,4.6,0,9-.6,13.2-2.5,4.5-2.1,9.2-4.1,13.8-6,2.2-.9,4.4-2.1,5.8-4,5.3-7.3,11.3-14.1,15.8-22.1,15.7-28.7,32.1-57,47.7-85.7,8.4-15.5,16.3-31.3,18-49.4.3-3.1-1.3-8,2.4-8.8,3.5-.7,4.5,4.4,6,7.2,21.1,37.7,41.9,75.6,63.2,113.1,7.7,13.7,14.4,28,24.4,40.4,9.7,12.1,22.7,17.7,37.2,18.1,32.3.8,64.5.2,96.8.4,5.7,0,10.9-1,15.9-3.5s6.9-3.4,10.5-4.7c3.5-1.3,6.3-3.4,8.5-6.3,4.8-6.2,9.7-12.4,13.5-19.4,8.4-15.5,16.9-31,25.5-46.5,5.6-10.2,11.3-20.4,17.1-30.7.7-1.2,1.2-3,2.9-2.6,1.6.4,1.7,2.2,1.7,3.6,0,14.9,2.9,29.4,4.3,44.2.5,5.1,1.9,9.8,3.8,14.4,1.7,4.2,3.3,8.4,5.2,12.5,6.8,14.7,14.7,28.1,31.4,34.1,7.1,2.5,13.7,4.9,21.3,4.7,16.2-.4,32.5-.4,48.8,0,9.3.2,18-.8,26.1-5.6,4.1-2.4,9-3,12.5-6.8,12.6-13.7,21-30,24.5-47.9,3.1-15.8,5.1-32,4.9-48.4-.4-53.3-.5-106.6-.6-159.9,0-7.9.2-8.2,8-8.2,18.2,0,36.3-.6,54.5.2,11.9.5,21.9-4.1,32.1-8.5,2-.9,3.7-2.3,5-4,5.6-7.7,11.9-14.9,16.3-23.5,6.2-12.1,12.7-24.1,19.1-36.1,2.9-5.5,6-10.9,9-16.3.6-1,1.3-2.2,2.7-2,1.5.2,1.5,1.7,1.6,2.8.2,2.4.2,4.8.2,7.2.3,72.6.6,145.3.7,217.9,0,23.4.9,46.7,5,69.9,3.2,18.1,9.4,34.3,20.3,48.9,10,13.4,23.8,19.4,39.4,19.5,77.2.5,154.4.2,231.5.2s3.7,0,4.8,0c17.1-.6,22.6-6.3,32.8-14.7,1.9-1.6,3.6-2.8,5.4-.5,6.8,8.3,14.9,11.3,23.3,14.2,4.6.9,7.4,1.1,9.8,1.1,20.8,0,41.6.4,62.3-.2,11-.3,21.6-5.1,29.3-11.9,14-12.4,22.1-29.7,25.7-47.8,4.3-21.5,6.8-43.4,5.8-65.5-.6-13.1-.2-26.3-.2-39.4s0-4.3.3-6.4c0-.9.2-2,1.4-2.2,1.2-.2,1.5.8,1.9,1.7.5,1.3,1.1,2.6,1.6,4,16.7,43.6,33.4,87.3,50.3,130.9,5.7,14.6,14.4,26.4,30.2,32.2,7.8,2.8,15.2,5,23.5,4.7,11-.3,22-.2,33,0,4.2,0,8.1-.7,11.8-2.4,5-2.3,10.1-4.4,15.1-6.6,2.2-.9,4.1-2.3,5.8-4.1,12.7-14.5,21.6-31.1,25-50,2.6-14.3,4.8-28.8,4.8-43.4l-3.2-661h0c0-20.8.6-41.6-3.2-62.2-2.3-12.2-3.4-24.5-8.5-36.1-8-18.2-18-34.1-38.4-40.5-3.9-1.2-7.5-2.8-11.7-2.8-21.5,0-43-.6-64.5,0-21.5.6-38.6,22.7-38.6,22.7h0ZM512.5,576.3c-2.3,3.6-4.8,2.6-6.6-.4-4.2-6.9-7.7-13.6-7.7-22.5.2-63.5,0-127.1-.6-190.7,0-8.5,4.2-14.4,8.1-20.8,1.5-2.4,3.7-2.1,5.2.2,3.9,6.2,8.1,11.9,7.9,20.2l.8,97.5c0,32.2-.2,64.5,0,96.8,0,7.7-3.2,13.8-7.1,19.8h0Z`; // your existing path data

	let maskLoaded = false;
    
    // Create an SVG element to preload the mask
    if (typeof window !== 'undefined') {
        const img = new Image();
        img.onload = () => maskLoaded = true;
        img.src = `data:image/svg+xml;utf8,<svg viewBox='0 0 1686 912' xmlns='http://www.w3.org/2000/svg'><path d='${maskPath}' fill='white'/></svg>`;
    }
</script>

<section class="pb-4 md:pb-4 {styleClasses}" data-id={slice.primary.hash}>
	{#if style != 'logo'}
		<div class="{style == 'box' ? 'md:px-8' : ''}" data-aos="fade-up">
			<div class="{style == 'full' ? 'rounded-none' : 'rounded-lg   overflow-hidden'} h-auto">
				{#if slice.primary.video}
					<video 
						src={slice.primary.video} 
						poster={slice.primary.image.url} 
						class="w-full h-auto bg-[var(--secondary-color)]" 
						playsinline 
						autoplay={!slice.primary.controlled}
						controls={slice.primary.controlled}
						muted={!slice.primary.controlled}
						loop 
					/>
				{:else}
					<PrismicImage class="w-full h-auto bg-[var(--secondary-color)]" field={slice.primary.image} />
				{/if}
			</div>

			<div class="mx-auto text-neutral-500 pt-3 text-sm text-center mx-auto md:w-8/12">
				<PrismicText field={slice.primary.text} />
			</div>
		</div>
	{:else}
		<div class="px-3 md:px-8 md:mb-12 w-full relative">
			<div 
				class="w-full aspect-[1686/912]"
				style="
					opacity: {maskLoaded ? 1 : 0};
					transition: opacity 0.3s ease;
					mask-image: url('data:image/svg+xml;utf8,<svg viewBox=\'0 0 1686 912\' xmlns=\'http://www.w3.org/2000/svg\'><path d=\'{maskPath}\' fill=\'white\'/></svg>');
					-webkit-mask-image: url('data:image/svg+xml;utf8,<svg viewBox=\'0 0 1686 912\' xmlns=\'http://www.w3.org/2000/svg\'><path d=\'{maskPath}\' fill=\'white\'/></svg>');
					mask-size: contain;
					-webkit-mask-size: contain;
					mask-repeat: no-repeat;
					-webkit-mask-repeat: no-repeat;
					mask-position: center;
					-webkit-mask-position: center;
				"
			>
				{#if slice.primary.video}
					<video 
						src={slice.primary.video} 
						poster={slice.primary.image.url} 
						class="w-full h-full object-cover bg-[var(--secondary-color)]" 
						playsinline 
						autoplay={!slice.primary.controlled}
						controls={slice.primary.controlled}
						muted={!slice.primary.controlled} 
						loop 
					/>
				{:else}
					<PrismicImage 
						class="w-full h-full object-cover bg-[var(--secondary-color)]" 
						field={slice.primary.image} 
					/>
				{/if}
			</div>
		</div>
	{/if}
</section>

